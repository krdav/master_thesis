
\iffalse




\chapter{B cell receptor amino acid profiles}

%%%%%%% from aammp paper
Germinal center (GC) maturation is a central process of the adaptive immune system.
The Darwinian selection undertaken inside a GC is driven by B cells' ability to bind the antigen through the membrane bound B cell receptor (BCR), also known as an antibody.
The population of B cells are under stringent selection while being highly mutated, driving the cell population towards higher and higher affinity until the GC is eventually dissolved.

Each GC are though of as founded by one or a few B cells and binding just a single epitope \cite{tas2016visualizing}.
The evolutionary process is undertaken in small steps to improve the binding to this specific epitope surface and therefore it is unlikely that a switch in epitope specificity will occur.
Assuming that this holds, all cell within a clonal family will have evolved in the same context, with the objective of improving binding to the same surface as the founder cell.
Different GCs can have different epitope specificities and in these different contexts each GC will have their own fitness landscape.

When sequencing B cell repertoires it is possible to establish the clonal identity of each sequence with reasonable confidence \cite{ralph2016likelihood}, thereby relating each sequence to the GC they arose, but it is much more difficult to reconstruct the evolutionary process and the selection that happened inside the GC.
We separate selection into two classes, local and global selection.
Local selection is the context specific selection happening on all of the B cell of a single GC because they evolve towards binding the same epitope.
Local selection is therefore working on the level of epitope binding with positive selection for those mutations that confer tighter binding and vice versa.
Local selection is strictly related to binding of a single epitope surface but whether change in binding is due to direct antibody epitope contact or indirect effects improving binding by framework stabilizing or other ways, is irrelevant.
In fact the local effects capture everything we would like to estimate, there is just not sufficient data to do so and therefore we turn to global effects.
Global effects on selection are the subset of local effects shared between clonal families.
These will be different from direct binding effects and typically reflect conservation of general antibody features such as frame work beta sheet interactions and protein stability.
Analysis of global effect in a large repertoire was recently undertaken by McCoy et al.\ where it was found that selection was correlated with surface exposure of a residue \cite{mccoy2015quantifying}.
This might be an indirect effect related to the correlation between surface exposure of a residue and its effect on protein stability \cite{echave2016causes}.

In the selection process some mutations will increase the BCR affinity and eventually be fixed, while some might be deleterious and counter selected, and finally some are just neutral accumulating throughout the evolution.
This can be expressed in the terms of a observation probability vector for each position, where the probability of is observing a given amino acid is proportional to the fitness of that amino acid vs.
the other 19 possible substitutions.
Raw counts of amino acids over each site will at the limit of an infinite number of sequence observations correspond to the true vector of probabilities however due to the limited number of sequences occurring in a GC, raw counts is not a good estimator.
Therefore it is necessary to enforce the estimate of selection within a single GC with information derived from similar GCs.
In this scheme the local context specific effects will be combined with global information derived from many more sequences from related GCs by using the global effects as prior information feeding into the selection estimate on local scale.

While germinal center phylogenetic reconstruction is highly informed by nucleotide sequences, selection is working on protein sequences and synonymous codons, coding the same amino acid, does not possess any fitness advantage.
The functional form of the BCR is a protein and therefore the purpose of our model is the describe the selection on codon level.
Furthermore the codon level of selection is of increasing interest due to the potential use in engineering antibodies for human disease therapy like cancer, acute infections, auto-immune disease and rare genetic disease.

In this article we are suggesting a new approach to leverage global constraints on the BCR protein sequence across different epitope contexts with local information of sequences sharing the same epitope context.
Using this model it is possible to find the conserved sites and most likely allowed substitutions, useful in antibody engineering while keeping the target epitope conserved.


%%%%%%




\section{Model description}
%Amrit has a small section on a math description of aammp:
Maybe insert math description:
\url{https://www.overleaf.com/8548257cyshmbtrkywn#/30398139/}




Simulation of expected substitution profile given the naive sequence, mutation burden and motif model.








\fi


\chapter{Perspectives}
Understanding the mechanisms of BCR evolution in GCs is one of the most fundamental topics in the research area of adaptive immunity.
The ability of the human body to produce high affinity antibodies has profound implications in human medicine, immediately apparent by their role in preventing bacterial and viral infections through vaccines or previous exposure, but also through the role of auto-antibodies in autoimmune diseases, with pemphigus vulgaris \cite{payne2005genetic} myasthenia gravis \cite{lindstrom1998antibody} and rheumatoid arthritis \cite{steiner2002autoantibodies} being just a few examples.
Not only will better understanding of GC evolution be an advancement in human molecular physiology but, maybe even more so, an important step towards taking advantage of mechanistic understanding of adaptive immunity to engineer better vaccines, the next cancer drug or treatments of autoimmune diseases.

Phylogenetic inference plays an important role in the study of BCR evolution.
Used correctly, phylogenetic inference is a strong tool offering a large body of ordered information directly useful as an engineering tool or to create new hypotheses to be scrutinized by experimental studies.
On the other hand phylogenetic inference can also be misused by over-emphasizing its importance, neglecting the uncertainties involved in the inference or just by plain misunderstanding.
With the recent technological advances of HTS the possibilities of studying BCR evolution has expanded into new dimensions, and with this have followed an increasing interest in applying phylogenetic tools to study everything from vaccine responses \cite{raymond2016influenza}, to development of broadly neutralizing antibodies (bnAbs) targeting HIV \cite{Doria-Rose2014-vi}, \cite{Wu2011-yj}, \cite{Zhu_undated-zz} and influenza \cite{pappas2014rapid}, \cite{xu2015key} and even in studying the repertoire effects of aging \cite{de2017phylogenetic}.
ASR has been used to reveal that one of the barriers for eliciting bnAbs towards HIV is that they tend to evolve from self-reactive naive sequences \cite{williams2017potent}, \cite{liao2011initial}, thereby making it less likely for possible bnAb precursors to receive T cell help to found and sustain a GC.

In the last decade development of therapeutic antibodies has boomed, with at least 47 FDA approved and marketed antibodies and growing number of approvals \cite{ecker2015therapeutic} the market for antibodies has never been stronger.
Most antibodies derive from animal immunization or human PBMC isolation \cite{reichert2012marketed} and are therefore a direct outcome of GC affinity maturation.
In such instances the evolutionary history of a antibody can be of tremendous interest due to its application in antibody engineering.
Suppose the phylogenetic tree of the GC maturation can be reconstructed, this will provide a wealth of information about sequence conservation and relationship to other sequences with the same antigen binding site, information that can be applied in engineering and optimization which is a bottleneck in the antibody discovery phase \cite{dubel2014handbook}.
Phylogenetic method are therefore important across the board, from basic research to pure sequence engineering.

In this work we have defined a novel way of comparing ASR using an alignment of reconstructed lineages and normalizing to a per-site expected error.
%EM I feel like the original motivation for COAR, namely that we are interested in the expected error in reconstructing lineage leading to a particular sequence which has been identified using lab work, could be greater emphasized here and in the COAR introduction.
We call this the COAR metric, and it is especially useful for assessing the ASR performance of different phylogenetic inference method on simulated data.
For simulation of sequences on a fixed tree ASR performance can readily be evaluated by comparing equivalent nodes, as done by Hoehn et al.\ \cite{Hoehn2016-wg}, however when the tree itself is also being simulated e.g.\ by a stochastic branching processes, then the comparison becomes less trivial.
COAR provides a way of producing comparable ASR benchmark values regardless of the simulation methods used and we hope that this will be useful in future work of ASR validation.

To validate different inference methods we also created a framework for simulating trees by a stochastic branching process using an SHM biased mutation process.
To simulate the Darwinian selection occurring in the GC maturation we couple a branching process simulation with affinity based selection acting on individual sequences.
Using COAR and other validation metrics we have run extensive validation studies and shown that a variety of phylogenetic inference is robust and accurately reconstructs ancestral sequences.
The validation also showed that incorporation of sequence metadata like abundances can significantly increase the performance of ASR.
IgPhyML, which is the only method to explicitly model the context sensitive mutation process of SHM, did to our surprise not perform better than the other methods.
We speculate that there is there is not enough signal from the SHM bias due to the relatively shallow trees, including the fact that IgPhyML is using a mean field approximation which is prone to averaging out large parts of signal embedded in the sequence motifs.
Unfortunately this mean field approximation is necessary to achieve site independence and making a tractable likelihood evaluation and therefore the problem is not easily solved by a modification to the model.

In future iterations of this validation we would like to investigate in more detail whether SHM motifs can be integrated in other ways into the inference algorithm and then search for situations where this might add significant value.
We are currently working on using motif information in a similar way as abundance information is used in GCtree i.e.\ calculating the likelihood of a tree given a motif model and then ranking a set of equally parsimonious trees according to their motif based likelihood.
It is also possible for us to avoid the problem of shallow trees by sampling multiple time points during the simulated GC evolution, and in addition to solving that problem it will answers essential questions about the validity of BCR phylogenies inferred on PBMC samples drawn at different stages of an immunization.
Inferring phylogenies from a time series of samples could be an interesting way of exploring the evolutionary trajectories of an immunization in the future.

There will always be a question about just how realistic sequence simulations are, whether they are too easy, bias or not capturing the traits of real GC evolution.
We have presented two alternative approaches to simulate GC evolution and shown that these represent varying degrees of difficulties for inference methods, however we imagine that the affinity selection model could be even more challenging by drawing target affinities and "distance to affinity" conversion steepnesses ($k$ in \eqref{eq:hd2affy}) from a distribution rather than having a single value for all targets.
Alternatively a much more detailed mechanistic model could be used for affinity simulations.
Unfortunately, methods like hyphasma \cite{robert2017simulate} does not support simulation of BCR sequences but it does integrate a string comparison method as a proxy for affinity.
It appears to be possible that the explicit DNA representation of BCR sequences described in our affinity simulation could be transferred into the larger framework of hyphasma, thereby enabling sequence simulation from a high level mechanistic model.
Lastly it is also possible that we can improve simulations further by adjusting simulation parameters to fit more characteristic behaviours found in real datasets.
One example would be to use the MP tree degeneracy as another metric for the simulated sequences to recapitulate.
With the big interest in germinal center biology and increasing technical advances, we expect soon to see more single GC datasets like the one from Tas et al.\ \cite{tas2016visualizing}.
Such datasets might even contain information like antigen affinities which could be used to adjust our affinity simulation at the same time as being excellent experimental data to recapitulate in a simulation.


